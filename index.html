<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Testing Revisit UI</title>
  <script src="https://unpkg.com/vue"></script>
  <style type="text/css">
  #container {
    width: 80%;
    margin: 2rem auto;
    position: relative;
  }


  #canvas {
    width: 100%;
    height: 500px;
  }


  #controls {
    width: 100%;
    display: flex;
    align-items: center;
    position: absolute;
    bottom: 0;
    margin: 0;
    padding: 0;
  }
  #controls:hover {
    background: rgba(200, 200, 200, 0.25);
  }


  #play-pause {
    flex: 0 0 10%;
    background: transparent;
    border: none;
    outline: none;
    text-align: center;
    margin: 0;
    padding: 0;
  }
  #play-pause svg {
    width: 100%;
    max-width: 50px;
    margin: 0;
    padding: 0;
    background: transparent;
    border: none;
    outline: none;
  }


  #timeline-label {
    flex: 0 0 10%;
    background: transparent;
    text-align: right;
    padding: 0;
    margin: 0;
  }
  #timeline-label span {
    margin: 0 0.5rem 0 0;
  }


  #playback-speed {
    flex: 0 0 15%;
  }
  #playback-speed input {
    width: 100%;
    margin: 0;
    padding: 0;
  }


  #playback-speed-label {
    flex: 0 0 5%;
    text-align: center;
    margin: 0;
    padding: 0;
  }


  #timeline {
    flex: 1;
    margin: 0;
    padding: 0;
  }
  #timeline input {
    width: 100%;
    margin: 0;
    padding: 0;
  }

</style>
</head>
<body>

  <div id="container">
    <canvas id="canvas"></canvas>

    <div id="controls" class="flxgrid">

      <div id="play-pause" v-on:click="isPlaying = !isPlaying">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 100 100" version="1.1">
          <!-- Left -->
          <polygon points="10 10, 50 30, 50 70, 10 90">
            <animate dur="0.3s" begin="startAnimation.begin" attributeName="points" values="10 10, 50 30, 50 70, 10 90; 10 10, 45 20, 45 80, 10 90; 10 10, 40 10, 40 90, 10 90" fill="freeze" />
            <animate dur="0.3s" begin="reverseAnimation.begin" attributeName="points" values="10 10, 40 10, 40 90, 10 90; 10 10, 45 20, 45 80, 10 90; 10 10, 50 30, 50 70, 10 90" fill="freeze" />
          </polygon>
          <!-- Right -->
          <polygon points="50 30, 90 50, 90 50, 50 70">
            <animate dur="0.3s" begin="startAnimation.begin" attributeName="points" values="50 30, 90 50, 90 50, 50 70; 55 20, 90 30, 90 70, 55 80; 60 10, 90 10, 90 90, 60 90" fill="freeze" />
            <animate dur="0.3s" begin="reverseAnimation.begin" attributeName="points" values="60 10, 90 10, 90 90, 60 90; 55 20, 90 30, 90 70, 55 80; 50 30, 90 50, 90 50, 50 70" fill="freeze" />
          </polygon>
          <!-- Invisivle rects as controls-->
          <rect x="0" y="0" height="100" width="100" fill-opacity="0">
            <animate dur="0.01s" id="startAnimation" attributeName="width" values="100; 0" fill="freeze" begin="click" />
            <animate dur="0.01s" attributeName="width" values="0; 100" fill="freeze" begin="reverseAnimation.end" />
          </rect>
          <rect x="0" y="0" height="100" width="0" r="0" fill-opacity="0">
            <animate dur="0.001s" id="reverseAnimation" attributeName="width" values="100; 0" fill="freeze" begin="click" />
            <animate dur="0.001s" attributeName="width" values="0; 100" begin="startAnimation.end"  fill="freeze"  />
          </rect>
        </svg>
      </div>

      <div id="timeline-label">
        <span>{{formatTime(time)}} / {{totalTime}}</span>
      </div>

      <div id="playback-speed">
        <input id="playback-speed-slider" type="range" name="playback-speed-slider" min="-5" max="5" step="0.1" v-model.number="speed">
      </div>

      <div id="playback-speed-label">
        {{speed | formatSpeed}}
      </div>

      <div id="timeline">
        <input id="timeline-slider" type="range" name="timeline-slider" min="0" max="10" step="0.01" v-model.number="time">
      </div>

    </div>
  </div>

  <script type="text/javascript">

  let canvas = document.getElementById("canvas");
  let ctx = canvas.getContext("2d");
  ctx.fillStyle = "rgba(0,0,100,0.1)";
  ctx.fillRect(0, 0, canvas.width, canvas.height);


  let vueapp = new Vue({
    el: "#controls",
    data: {
      isPlaying: false,
      time: 0,
      totalTime: 10,
      speed: 1
    },
    methods: {
      formatTime: function (t) {
        return t.toFixed(2);
      }
    },
    filters: {
      formatSpeed: function(s) {
        return "x" + s.toFixed(1);
      }
    }
  });


  let updatePeriod = 1/60;

  let timeline = document.getElementById("timeline-slider");
  var changing = false;
  timeline.addEventListener("mousedown", function () {
    changing = true;
  });
  timeline.addEventListener("mouseup", function () {
    changing = false;
  });

  function doSomething() {
    if (!changing && vueapp.isPlaying) {
      vueapp.time += updatePeriod * vueapp.speed;
      vueapp.time = Math.max(0, Math.min(vueapp.time, vueapp.totalTime));
    }
  }
  doSomething();
  setInterval(doSomething, updatePeriod * 1000);


</script>


</body>
</html>
